emission_spectrum = [
    8  3.120999e+7
    9  3.192045e+7
    10  3.135187e+7
    11  1.935684e+7
    12  1.619196e+7
    13  1.507718e+7
    14  1.522897e+7
    15  1.516036e+7
    16  1.500721e+7
    17  1.469434e+7
    18  1.427675e+7
    19  1.380020e+7
    20  1.329071e+7
    21  1.276408e+7
    22  1.222390e+7
    23  1.168494e+7
    24  1.115078e+7
    25  1.063484e+7
    26  1.013817e+7
    27  9.655685e+6
    28  9.194854e+6
    29  8.757718e+6
    30  8.336316e+6
    31  7.939601e+6
    32  7.560539e+6
    33  7.198872e+6
    34  6.860920e+6
    35  6.536249e+6
    36  6.226739e+6
    37  5.936945e+6
    38  5.658743e+6
    39  5.395550e+6
    40  5.143033e+6
    41  4.906175e+6
    42  4.680070e+6
    43  4.463209e+6
    44  4.257025e+6
    45  4.061022e+6
    46  3.872188e+6
    47  3.692747e+6
    48  3.520035e+6
    49  3.356233e+6
    50  3.199097e+6
    51  3.047380e+6
    52  2.902094e+6
    53  2.763307e+6
    54  2.628348e+6
    55  2.499422e+6
    56  2.374520e+6
    57  2.254612e+6
    58  2.916419e+6
    59  3.375726e+6
    60  1.918006e+6
    61  1.813466e+6
    62  1.710840e+6
    63  1.611870e+6
    64  1.515304e+6
    65  1.421633e+6
    66  1.330455e+6
    67  1.673528e+6
    68  1.152629e+6
    69  1.179334e+6
    70  960897.1
    71  880291.3
    72  800123.2
    73  719841.5
    74  640040
    75  559506.5
    76  473067.5
    77  387455.3
    78  302444.6
    79  166801.8
    80  0
];

attenuation_coeff_al = [
    1.00E-03			3.44E+03
    1.50E-03			1.17E+03
    1.56E-03			1.05E+03
    1.56E-03			1.15E+04
    2.00E-03			6.56E+03
    3.00E-03			2.29E+03
    4.00E-03			1.05E+03
    5.00E-03			5.61E+02
    6.00E-03			3.34E+02
    8.00E-03			1.46E+02
    1.00E-02			7.61E+01
    1.50E-02			2.31E+01
    2.00E-02			9.98E+00
    3.00E-02			3.27E+00
    4.00E-02			1.65E+00
    5.00E-02			1.07E+00
    6.00E-02			8.06E-01
    8.00E-02			5.85E-01
    1.00E-01			4.94E-01
    1.50E-01			4.00E-01
    2.00E-01			3.55E-01
    3.00E-01			3.02E-01
    4.00E-01			2.69E-01
    5.00E-01			2.45E-01
    6.00E-01			2.26E-01
    8.00E-01			1.98E-01
    1.00E+00			1.78E-01
    1.25E+00			1.59E-01
    1.50E+00			1.45E-01
    2.00E+00			1.25E-01
    3.00E+00			1.03E-01
    4.00E+00			9.01E-02
    5.00E+00			8.22E-02
    6.00E+00			7.70E-02
    8.00E+00			7.07E-02
    1.00E+01			6.72E-02
    1.50E+01			6.37E-02
    2.00E+01			6.29E-02
];

attenuation_coeff_al(:,1) = attenuation_coeff_al(:,1) * 1e3; % to keV
%plot(attenuation_coeff_al(:,1), attenuation_coeff_al(:,2))
%plot(emission_spectrum(:,1), emission_spectrum(:,2))

d = 5e-4; % cm
I_total = sum(emission_spectrum(1:8,2));
I_dim = 0;
for i = 1:8%size(emission_spectrum, 1)
    energy = emission_spectrum(i,1);
    for j = 1:size(attenuation_coeff_al, 1)-1
        a = attenuation_coeff_al(j,1);
        b = attenuation_coeff_al(j+1,1);
        if energy >= a && energy < b
            fa = attenuation_coeff_al(j,2);
            fb = attenuation_coeff_al(j+1,2);
            c = energy;
            
            k = (fb - fa)/(b - a);
            l = fa - k*a;
            mu = k*c + l;
            break;
        end
    end
    
    I_dim = I_dim + emission_spectrum(i,2)*exp(-mu*d);
end

att = I_dim / I_total
